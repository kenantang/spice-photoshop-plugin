# SPICE Photoshop Plugin

This repository contains the official implementation of **SPICE: A Synergistic, Precise, Iterative, and Customizable Image Editing Workflow**.  
For the paper and reference implementation, see:  
https://github.com/kenantang/spice

The **Photoshop plugin** is the recommended way to use SPICE. It tightly integrates SPICE’s iterative, error-correcting workflow with Photoshop’s powerful editing tools, enabling a seamless and efficient image editing experience.

The first version of the plugin has been **submitted to Adobe** and is currently **under review**. Upon approval, the plugin will be downloadable from the Adobe Marketplace. However, you can already use the code in this repository, if you have the Adobe UXP Developer Tools on your device.

## Getting Started

Follow the steps below to set up and use the SPICE Photoshop plugin.

### 1. Backend Setup

SPICE requires a backend that supports image inpainting.

- **Supported:** Automatic1111 Web UI  
- **Coming soon:** ComfyUI

Start Automatic1111 with API support enabled:

```bash
./webui.sh --api
```

By default, the Photoshop plugin sends requests to:

```
https://127.0.0.1:7860/
```

and receives edited images from the backend.

### 2. Editing Workflow in Photoshop

Inside Photoshop:

1. Add a **color patch** to the current layer.  
   - The color patch may also be placed on a separate layer.  
   - SPICE always uses the *current visible pixels* as input.
2. Use any **selection tool** to draw:
   - Masks  
   - Context dots
3. Enter a **text prompt**, then click **Generate**.

The edited result will appear as a **new layer** in the document. If you accept the result, you can merge it to the existing layer below. SPICE delivers a smooth and robust editing experience, despite operating as a fully single-layer workflow.

### 3. Controlling Output Quality

SPICE is designed to be controlled with a minimal number of parameters. Two sliders are provided:

- **Denoising Strength**
- **ControlNet Stop Step**

These two parameters are sufficient to achieve high-quality and controllable results, highlighting one of SPICE’s core advantages: powerful editing with very few knobs.


## Version Notes

- **0.0.1**
  - Initial minimal working version
  - Uses Automatic1111 Web UI as the backend

## Known Issues

1. **Full-image selection bug** 

   Selecting the entire image causes an error, likely due to an edge case in selection inversion.

   *Planned improvement:* check selection area before inverting.

2. **One-pixel image shift**  

   The output image frequently shift by one pixel. This issue originates from the image-pasting step in Photoshop, NOT from the editing model.

   **Workaround:**  Just move the edited result by one pixel in the correct direction.

   *Planned improvement:* the fix is likely in the step where the bounding box is extended to a square, as the output never shifted in both X and Y directions simultaneously.

3. **GUI flashing**  

   Masks and images are cropped in the GUI before being sent to the backend, which can cause flashing.

   *Planned improvement:* these basic image operations should be handled completely by the JS code, but not Photoshop GUI operations

4. **Silent failure when no selection is active**

   Clicking **Generate** without an active selection causes the UI to fail silently, leaving the button unresponsive.

   *Planned improvement:* handle exceptions in the editing function

5. **Prompt cannot be recovered**  
   
   If the prompt is accidentally edited or deleted, there is currently no undo/redo mechanism.  
   
   *Planned improvement:* add **Undo** and **Redo** buttons above the prompt box.

6. **PPI inconsistency issues**  
   The current image-pasting logic is not robust to different PPI settings.  
   
   **Workaround:**  
   - Start from an image with a consistent PPI (e.g., one generated by Automatic1111 text-to-image)
   - Resize the canvas while preserving PPI

    *Planned improvement:* since the GUI operations are sensitive to PPI, try to find a way to avoid GUI operations, similar to the solution of GUI flashing


7. **Missing progress indicator**  
   
   The frontend currently lacks a progress bar.  
   
   *Planned improvement:* indicate progress by changing the **Generate** button color.  
   (The Automatic1111 API supports querying generation progress.)

8. **Hard-coded advanced parameters**  
  
   Negative prompts, models, and other advanced parameters are currently hard-coded.  
  
   *Planned improvement:* add a dedicated **settings panel** for infrequently changed parameters.

## License

This project is licensed under the  
**Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License (CC BY-NC-SA 4.0)**.

You are free to:
- Share — copy and redistribute the material in any medium or format  
- Adapt — remix, transform, and build upon the material  

Under the following terms:
- **Attribution** — You must give appropriate credit and indicate if changes were made  
- **NonCommercial** — You may not use the material for commercial purposes  
- **ShareAlike** — If you remix, transform, or build upon the material, you must distribute your contributions under the same license  

Full license text:  
https://creativecommons.org/licenses/by-nc-sa/4.0/